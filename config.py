# =============================================
# config.py ‚Äî –¶–ï–ù–¢–†–ê–õ–¨–ù–´–ô –§–ê–ô–õ –ù–ê–°–¢–†–û–ï–ö –ü–†–û–ï–ö–¢–ê
# =============================================
"""
–§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤—Å–µ–≥–æ Telegram-–±–æ—Ç–∞ ¬´–£–º–Ω—ã–π –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫¬ª.

–ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Ç–∞–∫ —Å–¥–µ–ª–∞–Ω–æ:
1. –ö–ª–∞—Å—Å Config ‚Äî —ç—Ç–æ Singleton-–ø–æ–¥–æ–±–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω (—á–µ—Ä–µ–∑ classmethod).
   –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ–∑–¥–∞—ë–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ ‚Äî –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
2. –í—Å—ë –≤—ã–Ω–µ—Å–µ–Ω–æ –∏–∑ –∫–æ–¥–∞ –≤ –æ–¥–Ω–æ –º–µ—Å—Ç–æ ‚Äî –ª–µ–≥–∫–æ –º–µ–Ω—è—Ç—å –ø–æ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω/—Ç–µ—Å—Ç/–ª–æ–∫–∞–ª.
3. –ò—Å–ø–æ–ª—å–∑—É–µ–º pathlib.Path ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–ø–æ—Å–æ–± —Ä–∞–±–æ—Ç—ã —Å –ø—É—Ç—è–º–∏ (Python 3.6+).
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–æ–∫ logs/ –∏ graphs/ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ ‚Äî —á—Ç–æ–±—ã –±–æ—Ç –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–∞–¥–∞–ª –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π.
5. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ .env + fallback-–∑–Ω–∞—á–µ–Ω–∏—è ‚Äî –µ—Å–ª–∏ –≤ –æ–±–ª–∞–∫–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω—ã —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å, .env –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω.

–ê–≤—Ç–æ—Ä: Grok –ø–æ —Ç–≤–æ–µ–º—É –¢–ó
–î–∞—Ç–∞: 26 —Ñ–µ–≤—Ä–∞–ª—è 2026
–í–µ—Ä—Å–∏—è: 2.1 (production-ready)
"""

import os
from pathlib import Path
from dotenv import load_dotenv
import logging
from typing import Optional

# ====================== –ó–ê–ì–†–£–ó–ö–ê .env ======================
# –ó–∞–≥—Ä—É–∂–∞–µ–º .env —Ñ–∞–π–ª –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ.
# –í –æ–±–ª–∞–∫–µ (Railway/Render) –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–¥–∞—é—Ç—Å—è –≤ –ø–∞–Ω–µ–ª–∏ ‚Äî dotenv –∏—Ö –Ω–µ –Ω–∞–π–¥—ë—Ç –∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç.
# –≠—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –¥–µ–ø–ª–æ—è.
load_dotenv()

# ====================== –û–°–ù–û–í–ù–û–ô –ö–õ–ê–°–° –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò ======================
class Config:
    """
    –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Å –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–æ—Ç–∞.
    
    –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
        from config import Config
        
        print(Config.TELEGRAM_TOKEN)
        Config.create_dirs()  # —Å–æ–∑–¥–∞—Å—Ç logs/ –∏ graphs/
        
    –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Äî class attributes (–¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞).
    """

    # ====================== TELEGRAM ======================
    # –¢–æ–∫–µ–Ω –æ—Ç @BotFather. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å –≤ git!
    # –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π ‚Äî –±–æ—Ç –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è (aiogram –∫–∏–Ω–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Å—Ä–∞–∑—É).
    TELEGRAM_TOKEN: str = os.getenv("TELEGRAM_TOKEN")
    if not TELEGRAM_TOKEN:
        raise ValueError(
            "‚ùå TELEGRAM_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω! "
            "–°–æ–∑–¥–∞–π .env –∏–∑ .env.example –∏–ª–∏ –¥–æ–±–∞–≤—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ –ø–∞–Ω–µ–ª–∏ –æ–±–ª–∞–∫–∞."
        )

    # ====================== GROK / xAI ======================
    # API-–∫–ª—é—á –æ—Ç https://console.x.ai
    # –ú–æ–¥–µ–ª—å grok-4-1-fast-reasoning ‚Äî —Å–∞–º–∞—è –±—ã—Å—Ç—Ä–∞—è –∏ –¥–µ—à—ë–≤–∞—è –Ω–∞ —Ñ–µ–≤—Ä–∞–ª—å 2026.
    XAI_API_KEY: str = os.getenv("XAI_API_KEY")
    if not XAI_API_KEY:
        raise ValueError("‚ùå XAI_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω! –ü–æ–ª—É—á–∏ –Ω–∞ console.x.ai")

    GROK_MODEL: str = os.getenv("GROK_MODEL", "grok-4-1-fast-reasoning")
    GROK_MAX_TOKENS: int = int(os.getenv("GROK_MAX_TOKENS", "4000"))
    GROK_TEMPERATURE: float = float(os.getenv("GROK_TEMPERATURE", "0.7"))
    # –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 0.7 ‚Äî –±–∞–ª–∞–Ω—Å –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Ç–æ—á–Ω–æ—Å—Ç–∏ JSON-–æ—Ç–≤–µ—Ç–æ–≤.
    # –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ –æ—Ç–≤–µ—Ç—ã ‚Äî –ø–æ—Å—Ç–∞–≤—å 0.3.

    # ====================== –ê–î–ú–ò–ù –ò –õ–û–ì–ò ======================
    # –¢–≤–æ–π Telegram ID (—É–∑–Ω–∞–π —á–µ—Ä–µ–∑ @userinfobot). –°—é–¥–∞ –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –æ—à–∏–±–∫–∏.
    ADMIN_ID: int = int(os.getenv("ADMIN_ID", "0"))
    if ADMIN_ID == 0:
        logging.warning("‚ö†Ô∏è ADMIN_ID –Ω–µ —É–∫–∞–∑–∞–Ω ‚Äî –∞–¥–º–∏–Ω-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã")

    BOT_NAME: str = os.getenv("BOT_NAME", "–£–º–Ω—ã–π –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ v2.1")
    LOG_LEVEL: str = os.getenv("LOG_LEVEL", "INFO").upper()
    DEBUG: bool = os.getenv("DEBUG", "True").lower() in ("true", "1", "yes")

    # ====================== –ü–£–¢–ò –ö –§–ê–ô–õ–ê–ú ======================
    # BASE_DIR ‚Äî –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞. –†–∞–±–æ—Ç–∞–µ—Ç –∏ –ª–æ–∫–∞–ª—å–Ω–æ, –∏ –≤ Docker.
    BASE_DIR: Path = Path(__file__).parent.resolve()

    # –ü–∞–ø–∫–∏ –¥–ª—è –ª–æ–≥–æ–≤ –∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤
    LOGS_DIR: Path = BASE_DIR / "logs"
    GRAPHS_DIR: Path = BASE_DIR / "graphs"
    DB_PATH: Path = BASE_DIR / "planner.db"

    # ====================== –ú–ê–¢PLOTLIB (–≥—Ä–∞—Ñ–∏–∫–∏) ======================
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –≤—Å–µ—Ö 5 –≥—Ä–∞—Ñ–∏–∫–æ–≤ (–¥–µ–Ω—å, –Ω–µ–¥–µ–ª—è, –º–µ—Å—è—Ü, —Å–µ–º–µ—Å—Ç—Ä, –≥–æ–¥)
    GRAPH_DPI: int = int(os.getenv("GRAPH_DPI", "300"))          # –ö–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    GRAPH_FACE_COLOR: str = os.getenv("GRAPH_FACE_COLOR", "#0f0f0f")  # –¢—ë–º–Ω—ã–π —Ñ–æ–Ω
    GRAPH_TEXT_COLOR: str = os.getenv("GRAPH_TEXT_COLOR", "#ffffff")
    GRAPH_TITLE_COLOR: str = os.getenv("GRAPH_TITLE_COLOR", "#FF6B6B")  # –Ø—Ä–∫–æ-–∫—Ä–∞—Å–Ω—ã–π
    GRAPH_GRID_ALPHA: float = 0.3

    # ====================== APSCHEDULER (–±—É–¥–∏–ª—å–Ω–∏–∫–∏ –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è) ======================
    SCHEDULER_TIMEZONE: str = os.getenv("SCHEDULER_TIMEZONE", "Europe/Moscow")
    # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ú–æ—Å–∫–≤–∞. –ï—Å–ª–∏ —Ç—ã –≤ –¥—Ä—É–≥–æ–º —Ä–µ–≥–∏–æ–Ω–µ ‚Äî –ø–æ–º–µ–Ω—è–π.

    # ====================== –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ ======================
    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π –≤ –æ–¥–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞)
    MAX_EVENTS_PER_MESSAGE: int = 50

    # ====================== –ú–ï–¢–û–î–´ ======================
    @classmethod
    def create_dirs(cls) -> None:
        """
        –°–æ–∑–¥–∞—ë—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–ø–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞.
        
        –ü–æ—á–µ–º—É –≤—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ:
        - –ß—Ç–æ–±—ã –±–æ—Ç –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–∞–¥–∞–ª —Å FileNotFoundError.
        - –†–∞–±–æ—Ç–∞–µ—Ç –∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ, –∏ –ø–æ—Å–ª–µ git clone.
        """
        cls.LOGS_DIR.mkdir(parents=True, exist_ok=True)
        cls.GRAPHS_DIR.mkdir(parents=True, exist_ok=True)
        logging.info(f"‚úÖ –ü–∞–ø–∫–∏ —Å–æ–∑–¥–∞–Ω—ã: {cls.LOGS_DIR} –∏ {cls.GRAPHS_DIR}")

    @classmethod
    def get_logger(cls, name: str = __name__) -> logging.Logger:
        """
        –£–¥–æ–±–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª–æ–≥–≥–µ—Ä–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —É—Ä–æ–≤–Ω–µ–º.
        –ò—Å–ø–æ–ª—å–∑—É–π –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö: logger = Config.get_logger(__name__)
        """
        logger = logging.getLogger(name)
        logger.setLevel(cls.LOG_LEVEL)
        return logger

    @classmethod
    def print_config_summary(cls) -> None:
        """
        –í—ã–≤–æ–¥–∏—Ç –∫—Ä–∞—Å–∏–≤—É—é —Å–≤–æ–¥–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ (—Ç–æ–ª—å–∫–æ –≤ DEBUG-—Ä–µ–∂–∏–º–µ).
        –û—á–µ–Ω—å —É–¥–æ–±–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.
        """
        if not cls.DEBUG:
            return
        print("\n" + "="*60)
        print(f"üöÄ {cls.BOT_NAME} ‚Äî –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ó–ê–ì–†–£–ñ–ï–ù–ê")
        print("="*60)
        print(f"TELEGRAM_TOKEN:     {'‚úÖ –£–ö–ê–ó–ê–ù' if cls.TELEGRAM_TOKEN else '‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢'}")
        print(f"XAI_API_KEY:        {'‚úÖ –£–ö–ê–ó–ê–ù' if cls.XAI_API_KEY else '‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢'}")
        print(f"ADMIN_ID:           {cls.ADMIN_ID}")
        print(f"LOG_LEVEL:          {cls.LOG_LEVEL}")
        print(f"DEBUG:              {cls.DEBUG}")
        print(f"BASE_DIR:           {cls.BASE_DIR}")
        print(f"GRAPHS_DIR:         {cls.GRAPHS_DIR}")
        print(f"SCHEDULER_TIMEZONE: {cls.SCHEDULER_TIMEZONE}")
        print("="*60 + "\n")

    # ====================== –ë–£–î–£–©–ò–ï –†–ê–°–®–ò–†–ï–ù–ò–Ø ======================
    # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å:
    # REDIS_URL, GOOGLE_CALENDAR_CREDENTIALS, etc.
    # –ü–æ–∫–∞ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ, —á—Ç–æ–±—ã –Ω–µ —É—Å–ª–æ–∂–Ω—è—Ç—å.

    # REDIS_URL: Optional[str] = os.getenv("REDIS_URL")


# ====================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ò–ú–ü–û–†–¢–ï ======================
# –°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ: –ø—Ä–∏ –ª—é–±–æ–º –∏–º–ø–æ—Ä—Ç–µ config –º—ã —Å—Ä–∞–∑—É:
# 1. –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫–∏
# 2. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –±–∞–∑–æ–≤—ã–π logging
# 3. –í—ã–≤–æ–¥–∏–º —Å–≤–æ–¥–∫—É (–µ—Å–ª–∏ DEBUG)
Config.create_dirs()

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –ª–æ–≥–≥–µ—Ä–∞ (—á—Ç–æ–±—ã –≤—Å–µ –ª–æ–≥–∏ —à–ª–∏ –≤ —Ñ–∞–π–ª + –∫–æ–Ω—Å–æ–ª—å)
logging.basicConfig(
    level=Config.LOG_LEVEL,
    format="%(asctime)s | %(levelname)-8s | %(name)-20s | %(message)s",
    handlers=[
        logging.StreamHandler(),  # –≤ –∫–æ–Ω—Å–æ–ª—å
        logging.FileHandler(
            Config.LOGS_DIR / "bot.log",
            encoding="utf-8",
            mode="a"
        )
    ]
)

Config.print_config_summary()

logger = Config.get_logger(__name__)
logger.info("‚úÖ config.py —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
